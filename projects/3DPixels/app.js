(function(a){a.applicationCache&&a.applicationCache.addEventListener("updateready",function(b){if(a.applicationCache.status===a.applicationCache.UPDATEREADY){try{a.applicationCache.swapCache()}catch(g){}a.location.reload()}},!1)})(window);
angular.module("3DPixels","ngAnimate ngDialog ngRoute ngTouch colorpicker.module 3DPixels.controllers 3DPixels.directives 3DPixels.filters 3DPixels.services 3DPixels.templates".split(" ")).config(["$routeProvider","$locationProvider",function(a,b){a.when("/menu",{controller:"menu",templateUrl:"views/menu.html"});a.when("/pixels/:id",{controller:"pixels",templateUrl:"views/pixels.html"});a.otherwise({redirectTo:"/menu"})}]).run(["$rootScope","$location","$window","cordova","nwjs",function(a,b,g,e,
f){a.$on("$routeChangeSuccess",function(b,c){c.$$route&&(a.view=c.$$route.controller)});e&&g.document.addEventListener("deviceready",function(){g.document.addEventListener("backbutton",function(){"menu"===a.view?navigator.app.exitApp():b.path("/menu")})});f&&(e=require("nw.gui"),f=new e.Menu({type:"menubar"}),f.createMacBuiltin("3DPixels"),e.Window.get().menu=f)}]);angular.module("3DPixels.controllers",[]).controller("menu",["$scope","$window","$location","Pixels","preferences","cordova","RunPrefixMethod",function(a,b,g,e,f,h,c){a.preferences=f;a.pixels=e.all();a.load=function(a){!h&&c(b.document.body.parentNode,"RequestFullScreen");g.path("/pixels/"+a.id)};a.remove=function(c){if(confirm("\u00bfEst\u00e1s seguro?"))for(var b=0;b<a.pixels.length;b++)if(a.pixels[b].id===c.id){a.pixels.splice(b,1);e.remove(c.id);break}}}]).controller("createPixels",["$scope",
"$location","ngDialog","Pixels",function(a,b,g,e){a.width=64;a.height=32;a.transparent=!0;a.color="#ffffff";a.submit=function(){a.width=Math.max(8,Math.min(1024,a.width));a.height=Math.max(8,Math.min(1024,a.height));var f=a.transparent?-1:parseInt(a.color.substr(1),16),f=e.create(a.name,a.width,a.height,f);b.path("/pixels/"+f);g.close()};a.$watch("color",function(b,h){b!==h&&(a.transparent=!1)})}]).controller("pixels",["$scope","$routeParams","$location","$timeout","$window","Pixels","cordova","RunPrefixMethod",
function(a,b,g,e,f,h,c,B){e(function(){a.pixels=h.get(b.id);a.pixels||g.path("/menu");a.menu=function(){g.path("/menu");c||!B(f.document,"FullScreen")&&!B(f.document,"IsFullScreen")||B(f.document,"CancelFullScreen")}},0)}]);angular.module("3DPixels.directives",[]).directive("pixels",["$window","Display","Grid","Pixel","cordova","preferences",function(a,b,g,e,f,h){return{restrict:"E",scope:{pixels:"="},template:"<toolbox></toolbox><cursor></cursor>"+(h.debug?"<resolution>{{resolution}}</resolution><fps>{{fps}}fps</fps>":""),link:function(c,h,v){var w=angular.element(a.document.body).parent().addClass("pixels"),m=new b(c,h),q=new g(c.pixels.width,c.pixels.height),t=null,d=new THREE.Object3D,k=function(){m.resize();c.$apply()},
C=function(a){switch(a.keyCode){case 49:c.setMode("camera"===c.mode?"paint":"camera");break;case 50:c.setMode("paint");c.cursor.css("display","");break;case 51:c.setMode("erase");c.cursor.css("display","");break;case 52:c.setMode("pick");c.cursor.css("display","");break;case 53:c.toggleGrid()}};a.addEventListener("resize",k,!1);a.addEventListener("keydown",C,!1);c.$on("$destroy",function(){w.removeClass("pixels");a.removeEventListener("resize",k);a.removeEventListener("keydown",C);m.destroy()});f||
(m.renderer.domElement.addEventListener("mouseout",function(){c.cursor.css("display","none")},!1),m.renderer.domElement.addEventListener("mouseover",function(){"camera"!==c.mode&&c.cursor.css("display","")},!1));h=new THREE.Vector3(q.width/2,-q.height/2,.36*Math.max(q.width,q.height));for(var l in m.cameras)for(m.cameras[l].camera.position.set(h.x,h.y,h.z),m.cameras[l].controls.target=new THREE.Vector3(h.x,h.y,0),v=0;5>v;v++){var A=new THREE.PointLight(16777215,.45,0);3<=v?A.position.y=q.height/2*
(3===v?-1:1):A.position.x=v*q.width/2-q.width/2;m.cameras[l].camera.add(A)}m.scene.add(q);m.scene.add(d);c.setMode=function(a){switch(a){case "erase":case "paint":case "pick":m.setCamera("orthographic");c.grid&&(q.visible=!0);break;case "camera":m.setCamera("perspective"),q.visible=!1}c.mode=a};c.setMode("paint");c.color={hex:"#FFFFFF",uint:function(){return parseInt(this.hex.substr(1),16)}};c.grid=!0;c.toggleGrid=function(){c.grid=!c.grid;"camera"!==c.mode&&(q.visible=c.grid);d.children.forEach(function(a){a.box.visible=
c.grid})};c.setCurrentFrame=function(a){t=a;d.remove(d.children.slice(0));c.pixels.frames[t].colors.forEach(function(a,b){if(-1!==a){var h=new e(b%c.pixels.width,Math.floor(b/c.pixels.width),a);h.name=b;!c.grid&&(h.box.visible=!1);d.add(h)}})};c.setCurrentFrame(0);var p=new THREE.Raycaster,u=new THREE.Plane(new THREE.Vector3(0,0,0),0),n={down:!1,pos:new THREE.Vector2,worldPos:function(){var a=new THREE.Vector2(2*this.pos.x-1,2*-this.pos.y+1);p.setFromCamera(a,m.camera.camera);return p.ray.intersectPlane(u)}};
m.cameras.orthographic.controls.addEventListener("fingerdown",function(a){0===a.data.finger&&(n.down=!0,n.pos.copy(a.data.pos))});m.cameras.orthographic.controls.addEventListener("fingermove",function(a){0===a.data.finger&&n.pos.copy(a.data.pos)});m.cameras.orthographic.controls.addEventListener("fingerup",function(a){0===a.data.finger&&(n.down=!1,n.pos.copy(a.data.pos))});a.addEventListener("blur",function(a){n.down=!1},!1);c.animate=function(a){switch(c.mode){case "paint":case "erase":case "pick":if(n.down){var b=
n.worldPos();a=Math.floor(b.x/e.prototype.size);var h=Math.floor(-b.y/e.prototype.size),b=h*c.pixels.width+a;if(0<=a&&a<c.pixels.width&&0<=b&&b<c.pixels.width*c.pixels.height)switch(c.mode){case "paint":-1===c.pixels.frames[t].colors[b]?(a=new e(a,h,c.color.uint()),a.name=b,!c.grid&&(a.box.visible=!1),d.add(a)):d.getObjectByName(b).setColor(c.color.uint());c.pixels.frames[t].colors[b]!==c.color.uint()&&(c.pixels.frames[t].colors[b]=c.color.uint(),c.pixels.save());break;case "erase":-1!==c.pixels.frames[t].colors[b]&&
(d.remove(d.getObjectByName(b)),c.pixels.frames[t].colors[b]=-1,c.pixels.save());break;case "pick":-1!==c.pixels.frames[t].colors[b]&&(c.color.hex="#"+c.pixels.frames[t].colors[b].toString(16),c.mode="paint")}}}m.camera.controls.update()}}}}]).directive("toolbox",function(){return{restrict:"E",templateUrl:"partials/toolbox.html"}}).directive("cursor",["$window",function(a){return{restrict:"E",template:'<i class="fa fa-fw" data-ng-class="icon"></i>',link:function(b,g,e){var f=function(a){var c=a.clientY;
g.css("left",a.clientX+"px");g.css("top",c+"px")};b.$watch("mode",function(a){g.css("color","");switch(a){case "paint":b.icon="fa-paint-brush";g.css("color",b.color.hex);break;case "erase":b.icon="fa-eraser";break;case "pick":b.icon="fa-eyedropper";break;case "camera":g.css("display","none")}});b.$watch("color.hex",function(a){"paint"===b.mode&&g.css("color",a)});a.addEventListener("mousemove",f);g.css("display","none");b.cursor=g;b.$on("$destroy",function(){a.removeEventListener("mousemove",f)})}}}]);angular.module("3DPixels.filters",[]);angular.module("3DPixels.services",[]).factory("cordova",["$window",function(a){var b=null;a.cordova&&(b={});return b}]).factory("nwjs",["$window",function(a){var b=null;"undefined"!==typeof a.process&&"undefined"!==typeof a.require&&(b={});return b}]).factory("RunPrefixMethod",function(){var a=["webkit","moz","ms","o",""];return function(b,g){for(var e=0,f,h;e<a.length&&!b[f];){f=g;""==a[e]&&(f=f.substr(0,1).toLowerCase()+f.substr(1));f=a[e]+f;h=typeof b[f];if("undefined"!=h)return a=[a[e]],"function"==
h?b[f]():b[f];e++}}}).factory("arrayShuffle",function(){return function(a){for(var b=a.length;0!==b;){var g=Math.floor(Math.random()*b);b--;var e=a[b];a[b]=a[g];a[g]=e}}}).factory("preferences",["$window",function(a){var b={debug:!1,muted:!1,targetFPS:30},g=a.localStorage.getItem("3DPixelsPreferences");if(g)try{b=g=JSON.parse(g)}catch(e){}b.hasGL=!!function(){try{var a=document.createElement("canvas");return!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}();
b.save=function(){var e=JSON.parse(JSON.stringify(b));delete e.hasGL;delete e.save;a.localStorage.setItem("3DPixelsPreferences",JSON.stringify(e))};return b}]).factory("Display",["$window","$timeout","preferences","TrackballControls",function(a,b,g,e){var f=function(b,c){this.scope=b;this.renderer=new (g.hasGL?THREE.WebGLRenderer:THREE.CanvasRenderer)({antialias:!0});this.renderer.setSize(a.innerWidth,a.innerHeight);this.scene=new THREE.Scene;this.cameras={orthographic:{camera:new THREE.OrthographicCamera(a.innerWidth/
-2,a.innerWidth/2,a.innerHeight/2,a.innerHeight/-2,1,1E5)},perspective:{camera:new THREE.PerspectiveCamera(70,a.innerWidth/a.innerHeight,1,1E5)}};this.cameras.orthographic.camera.zoom=.5;this.cameras.orthographic.camera.updateProjectionMatrix();for(var f in this.cameras)this.cameras[f].controls=new e(this.cameras[f].camera),this.cameras[f].controls.enabled=!1;this.cameras.orthographic.controls.noRotate=this.cameras.orthographic.controls.staticMoving=!0;this.setCamera("orthographic");c.append(this.renderer.domElement);
this.scope.resolution=a.innerWidth+"x"+a.innerHeight;this.fps={countStart:0,counter:g.targetFPS-1};this.lastAnimationTicks=1*new Date;this.animate()};f.prototype.setCamera=function(a){this.camera&&(this.camera.controls.enabled=!1,this.scene.remove(this.camera.camera));this.camera=this.cameras[a];this.camera.controls.enabled=!0;this.scene.add(this.camera.camera)};f.prototype.animate=function(){var a=this,c=1*new Date,e=Math.max(0,1E3/g.targetFPS-(c-this.lastAnimationTicks));this.animationRequest=b(function(){a.animate()},
e);this.lastAnimationTicks=c+e;this.scope.animate&&(this.scope.animate&&this.scope.animate(c),this.renderer.render(this.scene,this.camera.camera),this.fps.counter++,1E3<=c-this.fps.countStart&&(g.debug&&(a.scope.fps=a.fps.counter),this.fps.countStart=c,this.fps.counter=0))};f.prototype.resize=function(){this.cameras.perspective.camera.aspect=a.innerWidth/a.innerHeight;this.cameras.perspective.camera.updateProjectionMatrix();this.cameras.perspective.controls.handleResize();this.cameras.orthographic.camera.left=
a.innerWidth/-2;this.cameras.orthographic.camera.right=a.innerWidth/2;this.cameras.orthographic.camera.top=a.innerHeight/2;this.cameras.orthographic.camera.bottom=a.innerHeight/-2;this.cameras.orthographic.camera.updateProjectionMatrix();this.cameras.orthographic.controls.handleResize();this.renderer.setSize(a.innerWidth,a.innerHeight);this.renderer.render(this.scene,this.camera.camera);g.debug&&(this.scope.resolution=a.innerWidth+"x"+a.innerHeight,this.scope.$apply())};f.prototype.destroy=function(){b.cancel(this.animationRequest);
for(var a in this.cameras)this.cameras[a].controls.destroy()};return f}]).factory("Pixel",function(){var a=function(a,g,e){THREE.Object3D.call(this);this.mesh=new THREE.Mesh(new THREE.BoxGeometry(32,32,32),new THREE.MeshPhongMaterial({color:e}));this.mesh.position.set(32*(a+.5),32*-(g+.5),0);this.add(this.mesh);this.box=new THREE.BoxHelper(this.mesh);this.box.material.transparent=!0;this.box.material.opacity=.5;this.add(this.box);this.setColor(e)};a.constructor=a;a.prototype=Object.create(THREE.Object3D.prototype);
a.prototype.size=32;a.prototype.setColor=function(a){this.mesh.material.color.set(a);var g=Math.max(0,Math.min(255,.5*(a>>16&255))),e=Math.max(0,Math.min(255,.5*(a>>8&255)));a=Math.max(0,Math.min(255,.5*(a&255)));this.box.material.color.set(g<<16|e<<8|a)};return a}).factory("Grid",["Pixel",function(a){var b=a.prototype.size;a=function(a,e){this.width=a*b;this.height=e*b;for(var f=new THREE.Geometry,h=new THREE.LineBasicMaterial({color:16777215,transparent:!0,opacity:.5}),c=0;c<=e;c++)f.vertices.push(new THREE.Vector3(0,
-c*b,0)),f.vertices.push(new THREE.Vector3(this.width,-c*b,0));for(c=0;c<=a;c++)f.vertices.push(new THREE.Vector3(c*b,0,0)),f.vertices.push(new THREE.Vector3(c*b,-this.height,0));THREE.Line.call(this,f,h,THREE.LinePieces)};a.constructor=a;a.prototype=Object.create(THREE.Line.prototype);return a}]).factory("Pixels",["$window","defaultPixels",function(a,b){var g=a.localStorage.getItem("3DPixels:Pixels"),e=[];if(g)try{e=g=JSON.parse(g)}catch(f){}else b.forEach(function(b){e.push(b.id);var c=[];b.frames.forEach(function(b){b=
{id:UUID.create(4).hex,colors:b};a.localStorage.setItem("3DPixels:PixelsFrames:"+id,JSON.stringify(b));c.push(b.id)});b.frames=c;b=JSON.parse(JSON.stringify(b));a.localStorage.setItem("3DPixels:Pixels:"+b.id,JSON.stringify(b))}),a.localStorage.setItem("3DPixels:Pixels",JSON.stringify(e));return{all:function(){var b=[];e.forEach(function(c){var e=a.localStorage.getItem("3DPixels:Pixels:"+c);try{if(e=JSON.parse(e))e.save=function(){var b=JSON.parse(JSON.stringify(e));delete b.$$hashKey;delete b.save;
a.localStorage.setItem("3DPixels:Pixels:"+c,JSON.stringify(b))},b.push(e)}catch(f){}});return b},get:function(b){var c=a.localStorage.getItem("3DPixels:Pixels:"+b);try{c=JSON.parse(c)}catch(e){return}if(c){for(var f=0;f<c.frames.length;f++){c.frames[f]=a.localStorage.getItem("3DPixels:PixelsFrames:"+c.frames[f]);try{c.frames[f]=JSON.parse(c.frames[f])}catch(g){return}if(!c.frames[f])return}c.save=function(){var e=JSON.parse(JSON.stringify(c));delete e.$$hashKey;delete e.save;e.frames=[];c.frames.forEach(function(c){e.frames.push(c.id);
a.localStorage.setItem("3DPixels:PixelsFrames:"+c.id,JSON.stringify(c))});e.lastModified=1*new Date;a.localStorage.setItem("3DPixels:Pixels:"+b,JSON.stringify(e))};return c}},create:function(b,c,f,g){var w=1*new Date;b={id:UUID.create(4).hex,name:b,width:c,height:f,frames:[UUID.create(4).hex],createdAt:w,lastModified:w};for(var w={id:b.frames[0],colors:[]},m=0;m<c*f;m++)w.colors[m]=g;a.localStorage.setItem("3DPixels:PixelsFrames:"+w.id,JSON.stringify(w));a.localStorage.setItem("3DPixels:Pixels:"+
b.id,JSON.stringify(b));e.push(b.id);a.localStorage.setItem("3DPixels:Pixels",JSON.stringify(e));return b.id},remove:function(b){for(var c=0;c<e.length;c++)if(e[c]===b){try{JSON.parse(a.localStorage.getItem("3DPixels:Pixels:"+b)).frames.forEach(function(b){a.localStorage.removeItem("3DPixels:PixelsFrames:"+b)})}catch(f){}a.localStorage.removeItem("3DPixels:Pixels:"+b);e.splice(c,1);a.localStorage.setItem("3DPixels:Pixels",JSON.stringify(e));break}}}}]).value("defaultPixels",[]).factory("TrackballControls",
function(){var a=function(a,g){function e(a){!1!==d.enabled&&(window.removeEventListener("keydown",e),A=l,l===k.NONE)&&(a.keyCode!==d.keys[k.ROTATE]||d.noRotate?a.keyCode!==d.keys[k.ZOOM]||d.noZoom?a.keyCode!==d.keys[k.PAN]||d.noPan||(l=k.PAN):l=k.ZOOM:l=k.ROTATE)}function f(a){!1!==d.enabled&&(l=A,window.addEventListener("keydown",e,!1))}function h(a){!1!==d.enabled&&(a.preventDefault(),a.stopPropagation(),l===k.NONE&&(l=a.button),l!==k.ROTATE||d.noRotate?l!==k.ZOOM||d.noZoom?l!==k.PAN||d.noPan||
(y.copy(r(a.pageX,a.pageY)),z.copy(y)):(x.copy(r(a.pageX,a.pageY)),D.copy(x)):(n.copy(F(a.pageX,a.pageY)),u.copy(n)),document.addEventListener("mousemove",c,!1),document.addEventListener("mouseup",B,!1),d.dispatchEvent(I),"canvas"===a.target.tagName.toLowerCase()&&d.dispatchEvent({type:"fingerdown",data:{finger:a.button,pos:r(a.pageX,a.pageY)}}))}function c(a){!1!==d.enabled&&(a.preventDefault(),l!==k.ROTATE||d.noRotate?l!==k.ZOOM||d.noZoom?l!==k.PAN||d.noPan||z.copy(r(a.pageX,a.pageY)):D.copy(r(a.pageX,
a.pageY)):(u.copy(n),n.copy(F(a.pageX,a.pageY))),d.dispatchEvent({type:"fingermove",data:{finger:a.button,pos:r(a.pageX,a.pageY)}}))}function B(a){!1!==d.enabled&&(a.preventDefault(),a.stopPropagation(),l=k.NONE,document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",B),d.dispatchEvent(J),d.dispatchEvent({type:"fingerup",data:{finger:a.button,pos:r(a.pageX,a.pageY)}}))}function v(a){if(!1!==d.enabled){a.preventDefault();a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/
40:a.detail&&(b=-a.detail/3);x.y+=.01*b;d.dispatchEvent(I);d.dispatchEvent(J)}}function w(a){if(!1!==d.enabled){switch(a.touches.length){case 1:l=k.TOUCH_ROTATE;n.copy(F(a.touches[0].pageX,a.touches[0].pageY));u.copy(n);"canvas"===a.target.tagName.toLowerCase()&&d.dispatchEvent({type:"fingerdown",data:{finger:0,pos:r(a.touches[0].pageX,a.touches[0].pageY)}});break;case 2:l=k.TOUCH_ZOOM_PAN;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;G=H=Math.sqrt(b*b+c*c);y.copy(r((a.touches[0].pageX+
a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));z.copy(y);break;default:l=k.NONE}d.dispatchEvent(I)}}function m(a){if(!1!==d.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:u.copy(n);n.copy(F(a.touches[0].pageX,a.touches[0].pageY));d.dispatchEvent({type:"fingermove",data:{finger:0,pos:r(a.touches[0].pageX,a.touches[0].pageY)}});break;case 2:var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;G=Math.sqrt(b*b+c*c);z.copy(r((a.touches[0].pageX+
a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));break;default:l=k.NONE}}function q(a){if(!1!==d.enabled){switch(a.touches.length){case 1:u.copy(n);n.copy(F(a.touches[0].pageX,a.touches[0].pageY));d.dispatchEvent({type:"fingerup",data:{finger:0,pos:r(a.touches[0].pageX,a.touches[0].pageY)}});break;case 2:H=G=0,z.copy(r((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2)),y.copy(z)}l=k.NONE;d.dispatchEvent(J)}}function t(a){a.preventDefault()}var d=
this,k={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=a;this.domElement=void 0!==g?g:document;this.enabled=!0;this.screen={left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3;var C=new THREE.Vector3,l=k.NONE,A=k.NONE,p=new THREE.Vector3,u=new THREE.Vector2,
n=new THREE.Vector2,K=new THREE.Vector3,E=0,x=new THREE.Vector2,D=new THREE.Vector2,H=0,G=0,y=new THREE.Vector2,z=new THREE.Vector2;this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();var L={type:"change"},I={type:"start"},J={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),
b=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-b.clientLeft;this.screen.top=a.top+window.pageYOffset-b.clientTop;this.screen.width=a.width;this.screen.height=a.height}};this.handleEvent=function(a){if("function"==typeof this[a.type])this[a.type](a)};var r=function(){var a=new THREE.Vector2;return function(b,c){a.set((b-d.screen.left)/d.screen.width,(c-d.screen.top)/d.screen.height);return a}}(),F=function(){var a=new THREE.Vector2;return function(b,c){a.set((b-
.5*d.screen.width-d.screen.left)/(.5*d.screen.width),(d.screen.height+2*(d.screen.top-c))/d.screen.width);return a}}();this.rotateCamera=function(){var a=new THREE.Vector3,b=new THREE.Quaternion,c=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3,h;return function(){g.set(n.x-u.x,n.y-u.y,0);(h=g.length())?(p.copy(d.object.position).sub(d.target),c.copy(p).normalize(),e.copy(d.object.up).normalize(),f.crossVectors(e,c).normalize(),e.setLength(n.y-u.y),f.setLength(n.x-u.x),
g.copy(e.add(f)),a.crossVectors(g,p).normalize(),h*=d.rotateSpeed,b.setFromAxisAngle(a,h),p.applyQuaternion(b),d.object.up.applyQuaternion(b),K.copy(a),E=h):!d.staticMoving&&E&&(E*=Math.sqrt(1-d.dynamicDampingFactor),p.copy(d.object.position).sub(d.target),b.setFromAxisAngle(K,E),p.applyQuaternion(b),d.object.up.applyQuaternion(b));u.copy(n)}}();this.zoomCamera=function(){var c;l===k.TOUCH_ZOOM_PAN?(c=H/G,H=G,a instanceof THREE.OrthographicCamera?(d.object.zoom=Math.max(0,d.object.zoom-c+1),d.object.updateProjectionMatrix()):
p.multiplyScalar(c)):(c=1+(D.y-x.y)*d.zoomSpeed,1!==c&&0<c&&(a instanceof THREE.OrthographicCamera?(d.object.zoom=Math.max(.1,d.object.zoom-c+1),d.object.updateProjectionMatrix(),x.copy(D)):(p.multiplyScalar(c),d.staticMoving?x.copy(D):x.y+=(D.y-x.y)*this.dynamicDampingFactor)))};this.panCamera=function(){var a=new THREE.Vector2,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.copy(z).sub(y);a.lengthSq()&&(a.multiplyScalar(p.length()*d.panSpeed),c.copy(p).cross(d.object.up).setLength(a.x),
c.add(b.copy(d.object.up).setLength(a.y)),d.object.position.add(c),d.target.add(c),d.staticMoving?y.copy(z):y.add(a.subVectors(z,y).multiplyScalar(d.dynamicDampingFactor)))}}();this.checkDistances=function(){d.noZoom&&d.noPan||(p.lengthSq()>d.maxDistance*d.maxDistance&&d.object.position.addVectors(d.target,p.setLength(d.maxDistance)),p.lengthSq()<d.minDistance*d.minDistance&&d.object.position.addVectors(d.target,p.setLength(d.minDistance)))};this.update=function(){p.subVectors(d.object.position,d.target);
d.noRotate||d.rotateCamera();d.noZoom||d.zoomCamera();d.noPan||d.panCamera();d.object.position.addVectors(d.target,p);d.checkDistances();d.object.lookAt(d.target);1E-6<C.distanceToSquared(d.object.position)&&(d.dispatchEvent(L),C.copy(d.object.position))};this.reset=function(){A=l=k.NONE;d.target.copy(d.target0);d.object.position.copy(d.position0);d.object.up.copy(d.up0);p.subVectors(d.object.position,d.target);d.object.lookAt(d.target);d.dispatchEvent(L);C.copy(d.object.position)};this.domElement.addEventListener("contextmenu",
t,!1);this.domElement.addEventListener("mousedown",h,!1);this.domElement.addEventListener("mousewheel",v,!1);this.domElement.addEventListener("DOMMouseScroll",v,!1);this.domElement.addEventListener("touchstart",w,!1);this.domElement.addEventListener("touchend",q,!1);this.domElement.addEventListener("touchmove",m,!1);window.addEventListener("keydown",e,!1);window.addEventListener("keyup",f,!1);this.handleResize();this.update();this.destroy=function(){this.domElement.removeEventListener("contextmenu",
t,!1);this.domElement.removeEventListener("mousedown",h,!1);this.domElement.removeEventListener("mousewheel",v,!1);this.domElement.removeEventListener("DOMMouseScroll",v,!1);this.domElement.removeEventListener("touchstart",w,!1);this.domElement.removeEventListener("touchend",q,!1);this.domElement.removeEventListener("touchmove",m,!1);window.removeEventListener("keydown",e,!1);window.removeEventListener("keyup",f,!1)}};a.prototype=Object.create(THREE.EventDispatcher.prototype);return a.prototype.constructor=
a});angular.module("3DPixels.templates",[]).run(["$templateCache",function(a){a.put("views/menu.html",'<h1>3DPixels</h1><nav><li data-ng-repeat="px in pixels | orderBy:\'-lastModified\'" data-ng-class-odd="\'odd\'" class="clearfix"><a data-ng-click="!editing &amp;&amp; load(px)"><span class="image" data-ng-click="editing &amp;&amp; remove(px)"><i data-ng-hide="editing" class="fa fa-paint-brush"></i><i data-ng-show="editing" class="fa fa-times"></i></span><span class="info"><span data-ng-hide="editing"><span class="name">{{px.name}}</span><small>Creado el: {{px.createdAt | date}}</small></span><span data-ng-show="editing"><input data-ng-show="editing" type="text" data-ng-model="px.name" data-ng-change="px.save()" required></span></span></a></li><li data-ng-show="pixels.length" class="edit" data-ng-class="{active: editing}"><a data-ng-click="editing = !editing"><i class="fa fa-edit"></i>Editar</a></li><li class="create"><a data-ng-dialog="partials/createPixels.html" data-ng-dialog-controller="createPixels"><i class="fa fa-plus"></i>Crear nuevo</a></li></nav><div data-ng-if="!preferences.hasGL" class="oldbrowser">!Cuidado! Tu dispositivo no soporta WebGL.</div><footer>Copyright (C) 2015 Daniel Esteban Nombela</footer>');
a.put("views/pixels.html",'<pixels data-ng-if="pixels" data-pixels="pixels"></pixels><a data-ng-click="menu()" class="menu"><i class="fa fa-fw fa-align-justify"></i></a>');a.put("partials/createPixels.html",'<h1>Crear nuevo</h1><form class="createPixels" name="form" data-ng-submit="!form.$invalid &amp;&amp; submit()"><label>Nombre</label><input type="text" name="name" data-ng-model="name" required autofocus><label>Tama\u00f1o</label><div class="row size"><div class="col-4"><input type="number" name="width" data-ng-model="width" min="8" max="1024" required></div><div class="col-4 times">&times;</div><div class="col-4"><input type="number" name="height" data-ng-model="height" min="8" max="1024" required></div></div><label>Fondo</label><div class="row"><div class="col-6"><label><input type="radio" name="transparent" data-ng-model="transparent" data-ng-value="true" required>Transparente</label></div><div class="col-6"><label><input type="radio" name="transparent" data-ng-model="transparent" data-ng-value="false" required>Color</label><div class="colorinput"><input type="text" data-ng-model="color" data-colorpicker data-colorpicker-close-on-select data-colorpicker-position="top"><span data-ng-style="{backgroundColor: color}"></span></div></div></div><div class="submit"><button type="submit">Crear</button></div></form>');
a.put("partials/toolbox.html",'<li data-ng-class="{active: mode === \'camera\'}"><a data-ng-click="setMode(mode === \'camera\' ? \'paint\' : \'camera\')"><i class="fa fa-fw fa-video-camera"></i></a></li><li data-ng-hide="mode === \'camera\'" data-ng-class="{active: mode === \'paint\'}"><a data-ng-click="setMode(\'paint\')"><i class="fa fa-fw fa-paint-brush"></i></a></li><li data-ng-hide="mode === \'camera\'" data-ng-class="{active: mode === \'erase\'}"><a data-ng-click="setMode(\'erase\')"><i class="fa fa-fw fa-eraser"></i></a></li><li data-ng-hide="mode === \'camera\'" data-ng-class="{active: mode === \'pick\'}"><a data-ng-click="setMode(\'pick\')"><i class="fa fa-fw fa-eyedropper"></i></a></li><li data-ng-class="{active: grid}"><a data-ng-click="toggleGrid()"><i class="fa fa-fw fa-th"></i></a></li><li data-ng-hide="mode === \'camera\'"><a class="color" data-ng-model="color.hex" data-colorpicker data-colorpicker-close-on-select data-colorpicker-position="top"><span data-ng-style="{backgroundColor: color.hex}"></span></a></li>')}]);
